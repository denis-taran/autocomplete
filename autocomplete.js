"use strict";exports.__esModule=true;function autocomplete(settings){var doc=document;var input;var container=doc.createElement("div");var containerStyle=container.style;var items=[];var minLen=settings.minLength||2;var selected;var keypressCounter=0;var unloaded;if(!settings.input){throw new Error("input undefined")}input=settings.input;doc.body.appendChild(container);container.className="autocomplete "+(settings.className||"");containerStyle.position="absolute";containerStyle.display="none";function containerDisplayed(){return containerStyle.display!=="none"}function clear(){keypressCounter++;items=[];selected=undefined;containerStyle.display="none"}function update(){while(container.firstChild){container.removeChild(container.firstChild)}var grouping=false;var prevGroup="#9?$";items.forEach(function(item){if(item.group){grouping=true}});var render=function(item){var itemElement=doc.createElement("div");itemElement.textContent=item.label;return itemElement};if(settings.render){render=settings.render}var renderGroup=function(groupName){var groupDiv=doc.createElement("div");groupDiv.textContent=groupName;return groupDiv};if(settings.renderGroup){renderGroup=settings.renderGroup}items.forEach(function(item){if(item.group&&item.group!==prevGroup){prevGroup=item.group;var groupDiv=renderGroup(item.group);if(groupDiv){groupDiv.className+=" group";container.appendChild(groupDiv)}}var div=render(item);if(div){div.addEventListener("click",function(ev){settings.onSelect(item.item,input);clear();ev.preventDefault();ev.stopPropagation()});if(item===selected){div.className+=" selected"}container.appendChild(div)}});if(items.length<1){if(settings.emptyMsg){var empty=doc.createElement("div");empty.className="empty";empty.textContent=settings.emptyMsg;container.appendChild(empty)}else{clear();return}}var inputRect=input.getBoundingClientRect();var strict=function(){return!this}();if(strict){var top_1=inputRect.top+input.offsetHeight+doc.documentElement.scrollTop}else{var top_2=inputRect.top+input.offsetHeight+doc.body.scrollTop}containerStyle.top=top+"px";containerStyle.left=inputRect.left+"px";containerStyle.width=input.offsetWidth+"px";containerStyle.maxHeight=window.innerHeight-(inputRect.top+input.offsetHeight)+"px";containerStyle.height="auto";containerStyle.display="block";updateScroll()}function resize(){if(containerDisplayed()){update()}}function keyup(ev){var keyCode=ev.which||ev.keyCode||0;var savedKeypressCounter=++keypressCounter;var ignore=[38,13,27,39,37,16,17,18,20,91,9];for(var _i=0,ignore_1=ignore;_i<ignore_1.length;_i++){var key=ignore_1[_i];if(keyCode===key){return}}if(keyCode===40&&containerDisplayed()){return}if(input.value.length>=minLen){settings.fetch(input.value,function(elements){if(keypressCounter===savedKeypressCounter&&elements&&!unloaded){items=elements;selected=items.length>0?items[0]:undefined;update()}})}else{clear()}}function updateScroll(){var elements=container.getElementsByClassName("selected");if(elements.length>0){var element=elements[0];var previous=element.previousElementSibling;if(previous&&previous.className.indexOf("group")!==-1&&!previous.previousElementSibling){element=previous}if(element.offsetTop<container.scrollTop){container.scrollTop=element.offsetTop}else{var selectBottom=element.offsetTop+element.offsetHeight;var containerBottom=container.scrollTop+container.offsetHeight;if(selectBottom>containerBottom){container.scrollTop+=selectBottom-containerBottom}}}}function selectPrev(){if(items.length<1){selected=undefined}else{if(selected===items[0]){selected=items[items.length-1]}else{for(var i=items.length-1;i>0;i--){if(selected===items[i]||i===1){selected=items[i-1];break}}}}}function selectNext(){if(items.length<1){selected=undefined}if(!selected||selected===items[items.length-1]){selected=items[0];return}for(var i=0;i<items.length-1;i++){if(selected===items[i]){selected=items[i+1];break}}}function keydown(ev){var keyCode=ev.which||ev.keyCode||0;if(keyCode===38||keyCode===40||keyCode===27){var containerIsDisplayed=containerDisplayed();if(keyCode===27){clear()}else{if(!containerDisplayed||items.length<1){return}keyCode===38?selectPrev():selectNext();update()}ev.preventDefault();if(containerIsDisplayed){ev.stopPropagation()}return}if(keyCode===13&&selected){settings.onSelect(selected.item,input);clear()}}function blur(){setTimeout(function(){if(doc.activeElement!==input){clear()}},200)}function destroy(){unloaded=true;input.removeEventListener("keydown",keydown);input.removeEventListener("keyup",keyup);input.removeEventListener("blur",blur);window.removeEventListener("resize",resize);clear();var parent=container.parentNode;if(parent){parent.removeChild(container)}}input.addEventListener("keydown",keydown);input.addEventListener("keyup",keyup);input.addEventListener("blur",blur);window.addEventListener("resize",resize);return{destroy:destroy}}exports.autocomplete=autocomplete;exports["default"]=autocomplete;